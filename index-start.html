<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Expense Tracker App</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 0; }
    .container { max-width: 400px; margin: 40px auto; background: #fff; padding: 24px; border-radius: 8px; box-shadow: 0 2px 8px #ccc; }
    h2 { text-align: center; }
    form { margin-bottom: 16px; }
    input[type="text"], input[type="number"], input[type="password"], input[type="date"], select {
      width: 100%; padding: 8px; margin: 6px 0 12px 0; border: 1px solid #ccc; border-radius: 4px;
    }
    .error { color: #dc3545; font-size: 12px; margin-top: -8px; margin-bottom: 8px; display: none; }
    .invalid { border-color: #dc3545 !important; }
    .required { color: #dc3545; }
    button { width: 100%; padding: 10px; background: #007bff; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #0056b3; }
    ul { list-style: none; padding: 0; }
    li { background: #f9f9f9; margin: 6px 0; padding: 8px; border-radius: 4px; display: flex; justify-content: space-between; }
    .total { font-weight: bold; margin-top: 12px; }
    .logout { background: #dc3545; margin-top: 12px; }
  </style>
</head>
<body>
  <div class="container" id="login-container">
    <h2>Login</h2>
    <form id="login-form">
      <input type="text" id="username" placeholder="Username" required />
      <input type="password" id="password" placeholder="Password" required />
      <button type="submit">Login</button>
    </form>
    <div id="login-error" style="color: red; display: none;">Invalid credentials.</div>
  </div>

  <div class="container" id="app-container" style="display: none;">
    <h2>Expense Tracker</h2>
    <form id="expense-form">
      <input type="text" id="desc" placeholder="Expense Description *" required />
      <div class="error" id="desc-error">Please enter a description (minimum 2 characters)</div>
      
      <select id="category" required>
        <option value="">Select Category *</option>
        <option value="Food">Food & Dining</option>
        <option value="Transport">Transportation</option>
        <option value="Shopping">Shopping</option>
        <option value="Bills">Bills & Utilities</option>
        <option value="Entertainment">Entertainment</option>
        <option value="Health">Healthcare</option>
        <option value="Other">Other</option>
      </select>
      <div class="error" id="category-error">Please select a category</div>
      
      <input type="number" id="amount" placeholder="Amount *" min="0.01" step="0.01" required />
      <div class="error" id="amount-error">Please enter a valid amount (minimum ₹0.01)</div>
      
      <input type="date" id="expense-date" required />
      <div class="error" id="date-error">Please select a valid date</div>
      
      <button type="submit">Add Expense</button>
    </form>
    <ul id="expense-list"></ul>
    <div class="total">Total: ₹<span id="total">0.00</span></div>
    <button class="logout" id="logout-btn">Logout</button>
  </div>

  <script>
    // Simple demo credentials
    const DEMO_USER = { username: "user", password: "pass" };

    // Login logic
    const loginForm = document.getElementById('login-form');
    const loginContainer = document.getElementById('login-container');
    const appContainer = document.getElementById('app-container');
    const loginError = document.getElementById('login-error');

    loginForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      if (username === DEMO_USER.username && password === DEMO_USER.password) {
        loginContainer.style.display = 'none';
        appContainer.style.display = 'block';
        loginError.style.display = 'none';
        loadExpenses();
      } else {
        loginError.style.display = 'block';
      }
    });

    // Logout logic
    document.getElementById('logout-btn').onclick = function() {
      appContainer.style.display = 'none';
      loginContainer.style.display = 'block';
      loginForm.reset();
    };

    // Expense tracker logic
    const expenseForm = document.getElementById('expense-form');
    const expenseList = document.getElementById('expense-list');
    const totalSpan = document.getElementById('total');

    function setTodayDate() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('expense-date').value = today;
    }

    function clearValidationErrors() {
      ['desc', 'category', 'amount', 'expense-date'].forEach(field => {
        document.getElementById(field).classList.remove('invalid');
        const errorId = field === 'expense-date' ? 'date-error' : `${field}-error`;
        document.getElementById(errorId).style.display = 'none';
      });
    }

    function showValidationError(fieldId, show = true) {
      const field = document.getElementById(fieldId);
      const errorId = fieldId === 'expense-date' ? 'date-error' : `${fieldId}-error`;
      const error = document.getElementById(errorId);
      
      if (show) {
        field.classList.add('invalid');
        error.style.display = 'block';
      } else {
        field.classList.remove('invalid');
        error.style.display = 'none';
      }
    }

    function validateExpenseForm() {
      clearValidationErrors();
      
      const desc = document.getElementById('desc').value.trim();
      const category = document.getElementById('category').value;
      const amount = parseFloat(document.getElementById('amount').value);
      const date = document.getElementById('expense-date').value;
      
      let isValid = true;
      
      // Validate description
      if (!desc || desc.length < 2) {
        showValidationError('desc');
        isValid = false;
      }
      
      // Validate category
      if (!category) {
        showValidationError('category');
        isValid = false;
      }
      
      // Validate amount
      if (!amount || amount <= 0 || amount < 0.01) {
        showValidationError('amount');
        isValid = false;
      }
      
      // Validate date
      if (!date) {
        showValidationError('expense-date');
        isValid = false;
      } else {
        const selectedDate = new Date(date);
        const today = new Date();
        const oneYearAgo = new Date();
        oneYearAgo.setFullYear(today.getFullYear() - 1);
        
        if (selectedDate > today || selectedDate < oneYearAgo) {
          document.getElementById('date-error').textContent = 'Date must be within the past year and not in the future';
          showValidationError('expense-date');
          isValid = false;
        }
      }
      
      return isValid;
    }

    function loadExpenses() {
      const expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
      renderExpenses(expenses);
      setTodayDate();
    }

    function formatDate(dateString) {
      if (!dateString) return '';
      const expenseDate = new Date(dateString);
      const today = new Date();
      const yesterday = new Date(today);
      yesterday.setDate(yesterday.getDate() - 1);
      
      if (expenseDate.toDateString() === today.toDateString()) {
        return 'Today';
      } else if (expenseDate.toDateString() === yesterday.toDateString()) {
        return 'Yesterday';
      } else {
        return expenseDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      }
    }

    function renderExpenses(expenses) {
      expenseList.innerHTML = '';
      let total = 0;
      expenses.forEach((exp, idx) => {
        total += parseFloat(exp.amount);
        const dateDisplay = exp.date ? ` (${formatDate(exp.date)})` : '';
        const categoryDisplay = exp.category ? `[${exp.category}] ` : '';
        const li = document.createElement('li');
        li.innerHTML = `
          <span>${categoryDisplay}${exp.desc} - ₹${parseFloat(exp.amount).toFixed(2)}${dateDisplay}</span>
          <button onclick="removeExpense(${idx})" style="background:#dc3545;color:#fff;border:none;padding:4px 8px;border-radius:3px;cursor:pointer;">Delete</button>
        `;
        expenseList.appendChild(li);
      });
      totalSpan.textContent = total.toFixed(2);
    }

    expenseForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      if (!validateExpenseForm()) {
        return;
      }
      
      const desc = document.getElementById('desc').value.trim();
      const amount = document.getElementById('amount').value;
      const date = document.getElementById('expense-date').value;
      const category = document.getElementById('category').value;
      let expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
      expenses.push({ desc, amount, date, category });
      localStorage.setItem('expenses', JSON.stringify(expenses));
      renderExpenses(expenses);
      expenseForm.reset();
      setTodayDate();
      clearValidationErrors();
    });

    // Remove expense (global for inline onclick)
    window.removeExpense = function(idx) {
      let expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
      expenses.splice(idx, 1);
      localStorage.setItem('expenses', JSON.stringify(expenses));
      renderExpenses(expenses);
    };

    // Add real-time validation on input changes
    document.getElementById('desc').addEventListener('blur', function() {
      const value = this.value.trim();
      if (value && value.length >= 2) {
        showValidationError('desc', false);
      }
    });

    document.getElementById('category').addEventListener('change', function() {
      if (this.value) {
        showValidationError('category', false);
      }
    });

    document.getElementById('amount').addEventListener('blur', function() {
      const value = parseFloat(this.value);
      if (value && value > 0 && value >= 0.01) {
        showValidationError('amount', false);
      }
    });

    document.getElementById('expense-date').addEventListener('change', function() {
      if (this.value) {
        const selectedDate = new Date(this.value);
        const today = new Date();
        const oneYearAgo = new Date();
        oneYearAgo.setFullYear(today.getFullYear() - 1);
        
        if (selectedDate <= today && selectedDate >= oneYearAgo) {
          document.getElementById('date-error').textContent = 'Please select a valid date';
          showValidationError('expense-date', false);
        }
      }
    });

    // Optional: Auto-load if already logged in (for demo, always show login)
    // loadExpenses();
  </script>
</body>
</html>
